<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js";

  // âœ… ã”è‡ªèº«ã® Firebase è¨­å®šã‚’è²¼ã‚Šä»˜ã‘ã‚‹
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT.appspot.com",
  };

  // FirebaseåˆæœŸåŒ–
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);

  // ğŸ“ è¨˜äº‹ä¿å­˜å‡¦ç†
  async function saveArticle() {
    const title = document.getElementById("title").value.trim();
    const summary = document.getElementById("summary").value.trim();
    const fullText = document.getElementById("fullText").value.trim();
    const file = document.getElementById("image").files[0];

    if (!title || !summary || !fullText) {
      alert("ã™ã¹ã¦ã®å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
      return;
    }

    try {
      let imgSrc = "";
      if (file) {
        // Firebase Storage ã«ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        const storageRef = ref(storage, `articles/${Date.now()}_${file.name}`);
        await uploadBytes(storageRef, file);
        imgSrc = await getDownloadURL(storageRef);
      }

      // Firestore ã«è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
      await addDoc(collection(db, "articles"), {
        title,
        summary,
        fullText,
        imgSrc, // â† ã“ã“ã§ç”»åƒURLã‚’ä¿å­˜
        createdAt: serverTimestamp(),
      });

      alert("è¨˜äº‹ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸï¼");
      document.getElementById("articleForm").reset();
      document.getElementById("imagePreview").src = "";

    } catch (error) {
      console.error("ä¿å­˜ã‚¨ãƒ©ãƒ¼:", error);
      alert("è¨˜äº‹ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
    }
  }

  // ğŸ–¼ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
  document.getElementById("image").addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (ev) => {
        document.getElementById("imagePreview").src = ev.target.result;
      };
      reader.readAsDataURL(file);
    }
  });

  // ãƒœã‚¿ãƒ³ã‹ã‚‰å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«
  window.saveArticle = saveArticle;
</script>

