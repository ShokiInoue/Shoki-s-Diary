<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-storage.js";

  // ✅ Firebase設定（ご自身の値に置き換え）
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT.appspot.com",
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);

  // 記事保存処理
  async function saveArticle() {
    const title = document.getElementById("title").value;
    const summary = document.getElementById("summary").value;
    const fullText = document.getElementById("fullText").value;
    const file = document.getElementById("image").files[0];

    if (!title || !summary || !fullText) {
      alert("必須項目を入力してください");
      return;
    }

    try {
      let imageUrl = "";
      if (file) {
        const storageRef = ref(storage, "articles/" + Date.now() + "_" + file.name);
        await uploadBytes(storageRef, file);
        imageUrl = await getDownloadURL(storageRef);
      }

      await addDoc(collection(db, "articles"), {
        title,
        summary,
        fullText,
        imageUrl,
        createdAt: serverTimestamp()
      });

      alert("記事が追加されました！");
      document.getElementById("articleForm").reset();
      document.getElementById("imagePreview").src = "";

    } catch (err) {
      console.error("保存エラー:", err);
      alert("記事の保存に失敗しました");
    }
  }

  // プレビュー表示
  document.getElementById("image").addEventListener("change", function() {
    const file = this.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = e => document.getElementById("imagePreview").src = e.target.result;
      reader.readAsDataURL(file);
    }
  });

  // ボタンから呼び出せるように
  window.saveArticle = saveArticle;
</script>
