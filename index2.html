<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è¨˜äº‹ã®è¿½åŠ </title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <div class="header">
    <h1>è¨˜äº‹ã®è¿½åŠ </h1>
  </div>

  <a href="index.html">
    <button>å…ƒã«æˆ»ã‚‹</button>
  </a>

  <form id="articleForm">
    <label for="image">ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ï¼š</label>
    <input type="file" id="image" accept="image/png, image/jpeg" required />
    <img id="imagePreview" alt="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒ" />
    <br /><br />

    <label for="title">ã‚¿ã‚¤ãƒˆãƒ«ï¼š</label>
    <input type="text" id="title" placeholder="ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›" required />
    <br /><br />

    <label for="summary">è¦ç´„ï¼š</label>
    <textarea id="summary" rows="3" required></textarea>
    <br /><br />

    <label for="fullText">æœ¬æ–‡ï¼š</label>
    <textarea id="fullText" rows="10" required></textarea>
    <br /><br />

    <button type="button" onclick="saveArticle()">è¨˜äº‹ã‚’è¿½åŠ </button>
  </form>

  <!-- ğŸ‘‡ ã“ã“ã«ã‚ãªãŸã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è²¼ã‚Šä»˜ã‘ã¾ã™ ğŸ‘‡ -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js";

    // âœ… Firebaseè¨­å®š
    const firebaseConfig = {
      apiKey: "AIzaSyBSDk3yqNU895fb7ujUE4wlSloIfke2h-I",
      authDomain: "shoki-diary.firebaseapp.com",
      projectId: "shoki-diary",
      storageBucket: "shoki-diary.firebasestorage.app",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    async function saveArticle() {
      const title = document.getElementById("title").value.trim();
      const summary = document.getElementById("summary").value.trim();
      const fullText = document.getElementById("fullText").value.trim();
      const file = document.getElementById("image").files[0];

      if (!title || !summary || !fullText) {
        alert("ã™ã¹ã¦ã®å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }

      try {
        let imgSrc = "";
        if (file) {
          const storageRef = ref(storage, `articles/${Date.now()}_${file.name}`);
          await uploadBytes(storageRef, file);
          imgSrc = await getDownloadURL(storageRef);
        }

        await addDoc(collection(db, "articles"), {
          title,
          summary,
          fullText,
          imgSrc,
          createdAt: serverTimestamp(),
        });

        alert("è¨˜äº‹ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸï¼");
        document.getElementById("articleForm").reset();
        document.getElementById("imagePreview").src = "";
      } catch (error) {
        console.error("ä¿å­˜ã‚¨ãƒ©ãƒ¼:", error);
        alert("è¨˜äº‹ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
      }
    }

    // ğŸ–¼ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å‡¦ç†
    document.getElementById("image").addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (ev) => {
          document.getElementById("imagePreview").src = ev.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    window.saveArticle = saveArticle;
  </script>
</body>
</html>


